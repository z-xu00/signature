<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>ç­¾åç”Ÿæˆ JSON å·¥å…·</title>
  <!-- å¼•å…¥ jSignature çš„ CSS å’Œ JSï¼ˆé€šè¿‡ CDNï¼‰ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jSignature/2.1.3/jSignature.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jSignature/2.1.3/jSignature.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    h2 { margin-bottom: 20px; }
    #signature {
      border: 1px solid #ccc;
      margin-bottom: 20px;
      width: 100% !important;
      height: 100% !important;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #jsonOutput {
      width: 100%;
      height: 250px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      background: #f4f4f4;
      padding: 10px;
      border: 1px solid #aaa;
      border-radius: 4px;
    }
    .copy-btn {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h2>ğŸ–Šï¸ è¯·åœ¨ä¸‹æ–¹ç­¾å</h2>
  <!-- jSignature ç”»å¸ƒå®¹å™¨ -->
  <div id="signature"></div>

  <br />

  <!-- ç‚¹å‡»ç”Ÿæˆ JSON -->
  <button onclick="generateAndShowJSON()">ç”Ÿæˆ JSON</button>

  <div class="copy-btn">
    <button onclick="copyJSONToClipboard()">ğŸ“‹ å¤åˆ¶ JSON</button>
  </div>

  <!-- æ˜¾ç¤ºç”Ÿæˆçš„ JSON -->
  <h3>ğŸ“„ ç”Ÿæˆçš„ JSONï¼ˆå¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼‰:</h3>
  <textarea id="jsonOutput" readonly placeholder="ç­¾ååç‚¹å‡»ã€Œç”Ÿæˆ JSONã€æŒ‰é’®ï¼ŒJSON å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>

  <script>
    // åˆå§‹åŒ– jSignature æ’ä»¶
    // è®¾ç½®ç”»å¸ƒå¤§å°ã€æ”¯æŒé€æ˜èƒŒæ™¯ã€æ”¯æŒç§»åŠ¨ç«¯
    $("#signature").jSignature({
      height: 400,
      'background-color': 'transparent',
      'decor-color': 'transparent',
      'lineWidth': 2,
      'color': '#000000'
    });

    // ç”Ÿæˆå¹¶å±•ç¤º JSON çš„å‡½æ•°
    function generateAndShowJSON() {
      // è·å–ç”¨æˆ·ç­¾åæ•°æ®
      let sigData = $("#signature").jSignature("getData");

      if (!sigData || sigData.length === 0) {
        alert("è¯·å…ˆç­¾åï¼");
        return;
      }

      // 1. è·å– SVG æ ¼å¼æ•°æ®
      let svgData = $("#signature").jSignature("getData", "svg");
      let svgBase64 = "";
      if (svgData && svgData.length === 2 && svgData[1]) {
        let rawSvg = svgData[1]; // è¿™æ˜¯ <svg>...</svg> å­—ç¬¦ä¸²
        // Base64 encode the SVG string
        svgBase64 = btoa(unescape(encodeURIComponent(rawSvg)));
      } else {
        svgBase64 = ""; // è‹¥æ²¡æœ‰ SVGï¼Œåˆ™ä¸ºç©º
      }

      // 2. è·å– base30 æ ¼å¼æ•°æ®ï¼ˆjSignature ç¬”è¿¹è½¨è¿¹æ•°æ®ï¼‰
      let base30Data = $("#signature").jSignature("getData", "base30");
      let base30Base64String = "";
      if (base30Data && base30Data.length === 2 && base30Data[1]) {
        base30Base64String = base30Data[1]; // è¿™å°±æ˜¯ "2Q74444Z2..." é‚£ä¸²æ•°æ®
      } else {
        base30Base64String = ""; // è‹¥æ²¡æœ‰ base30ï¼Œåˆ™ä¸ºç©º
      }

      // 3. æ„é€ ä½ æƒ³è¦çš„ JSON æ ¼å¼
      let outputJson = {
        svg: ["image/svg+xml;base64", svgBase64],
        base30: ["image/jsignature;base30", base30Base64String]
      };

      // 4. æ˜¾ç¤ºåˆ°é¡µé¢ textarea
      document.getElementById("jsonOutput").value = JSON.stringify(outputJson, null, 2);
    }

    // å¤åˆ¶ JSON åˆ°å‰ªè´´æ¿
    function copyJSONToClipboard() {
      const jsonOutput = document.getElementById("jsonOutput");
      if (!jsonOutput.value.trim()) {
        alert("è¯·å…ˆç”Ÿæˆ JSONï¼");
        return;
      }
      jsonOutput.select();
      document.execCommand("copy");
      alert("âœ… JSON å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
    }
  </script>

</body>
</html>
