<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>签名生成 JSON 工具</title>
  <!-- 引入 jSignature 的 CSS 和 JS（通过 CDN） -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jSignature/2.1.3/jSignature.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jSignature/2.1.3/jSignature.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    h2 { margin-bottom: 20px; }
    #signature {
      border: 1px solid #ccc;
      margin-bottom: 20px;
      width: 100% !important;
      height: 100% !important;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #jsonOutput {
      width: 100%;
      height: 250px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      background: #f4f4f4;
      padding: 10px;
      border: 1px solid #aaa;
      border-radius: 4px;
    }
    .copy-btn {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h2>🖊️ 请在下方签名</h2>
  <!-- jSignature 画布容器 -->
  <div id="signature"></div>

  <br />

  <!-- 点击生成 JSON -->
  <button onclick="generateAndShowJSON()">生成 JSON</button>

  <div class="copy-btn">
    <button onclick="copyJSONToClipboard()">📋 复制 JSON</button>
  </div>

  <!-- 显示生成的 JSON -->
  <h3>📄 生成的 JSON（可直接复制使用）:</h3>
  <textarea id="jsonOutput" readonly placeholder="签名后点击「生成 JSON」按钮，JSON 将显示在这里..."></textarea>

  <script>
    // 初始化 jSignature 插件
    // 设置画布大小、支持透明背景、支持移动端
    $("#signature").jSignature({
      height: 400,
      'background-color': 'transparent',
      'decor-color': 'transparent',
      'lineWidth': 2,
      'color': '#000000'
    });

    // 生成并展示 JSON 的函数
    function generateAndShowJSON() {
      // 获取用户签名数据
      let sigData = $("#signature").jSignature("getData");

      if (!sigData || sigData.length === 0) {
        alert("请先签名！");
        return;
      }

      // 1. 获取 SVG 格式数据
      let svgData = $("#signature").jSignature("getData", "svg");
      let svgBase64 = "";
      if (svgData && svgData.length === 2 && svgData[1]) {
        let rawSvg = svgData[1]; // 这是 <svg>...</svg> 字符串
        // Base64 encode the SVG string
        svgBase64 = btoa(unescape(encodeURIComponent(rawSvg)));
      } else {
        svgBase64 = ""; // 若没有 SVG，则为空
      }

      // 2. 获取 base30 格式数据（jSignature 笔迹轨迹数据）
      let base30Data = $("#signature").jSignature("getData", "base30");
      let base30Base64String = "";
      if (base30Data && base30Data.length === 2 && base30Data[1]) {
        base30Base64String = base30Data[1]; // 这就是 "2Q74444Z2..." 那串数据
      } else {
        base30Base64String = ""; // 若没有 base30，则为空
      }

      // 3. 构造你想要的 JSON 格式
      let outputJson = {
        svg: ["image/svg+xml;base64", svgBase64],
        base30: ["image/jsignature;base30", base30Base64String]
      };

      // 4. 显示到页面 textarea
      document.getElementById("jsonOutput").value = JSON.stringify(outputJson, null, 2);
    }

    // 复制 JSON 到剪贴板
    function copyJSONToClipboard() {
      const jsonOutput = document.getElementById("jsonOutput");
      if (!jsonOutput.value.trim()) {
        alert("请先生成 JSON！");
        return;
      }
      jsonOutput.select();
      document.execCommand("copy");
      alert("✅ JSON 已复制到剪贴板！");
    }
  </script>

</body>
</html>
